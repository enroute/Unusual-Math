
\chapter{历法}
\label{chap:calendar}

\epigraph{清明时节雨纷纷，路上行人欲断魂。\\借问酒家何处有，牧童遥指杏花村。}{唐·杜牧《清明》}

清明是中国从古流传至今的二十四节气之一，而公历是近代才传入中国的，为什么每年的清明不是公历4月4日就是4月5日呢？看完这节，希望你能想明白，一年中在2月29日之前的节气，每年都是固定日期的，而在2月29日之后的节气，每年都是差不多是固定日期的，最多相差一天。

\section{太阳历}
\label{sec:solar-calendars}

太阳历又称为阳历，是以地球绕太阳公转的运动周期为基础而制定的历法。

\begin{definition}[回归年，太阳年，Tropical Year，Solar Year]
  太阳年是指在地球上观察到太阳回到同一个地方所需要的时间，即地球绕太阳旋转一周所需要的时间，大约是$365.2422$天。
\end{definition}

日历年是日历中经过一年所包含的时间。历史上制定日历，除了记数之外，另外一个很重要的作用是指导农耕生产，因此自然是希望日历与太阳历越是一致越好，这样看日历就知道当天是处于什么季节。

为了记数方便，日历年都是取的整数，一般取为太阳年最接近的整数即365天。若日历年直接采用365天而不作其它修正的话，那么一年下来日历年与太阳年的误差为0.2422天，如下图。若不作修正的话，每个日历年上不同年份的同一个日期(比如1月1日)，地球所在的位置就会不一样。这样的话，日历就只剩余记数的作用，而失去了指导生活生产(比如农业种植)的作用，因为在这样的日历下，有些年份的1月1日甚至会是在炎热的夏季。

置闰的方法可以修正这个误差，即通过在日历年中插入天数来调整日历年与太阳年的误差。由于$0.2422\times4\approx1$，儒略历(Julian Calendar)就采用每4年添加一日(闰日)的方式来修正，即儒略历的平年有365天，每隔4年就要添加一日(闰日)，该年就是有366天的闰年。

\begin{center}
  \begin{tikzpicture}[scale=1.0]
    \begin{scope}
      % the sun
      \draw(0,0)node{\tiny Sun}circle(.3);
      \foreach \t in{0,30,60,90,120,150,180,210,240,270,300,330}{%
        \draw(\t:.5)--(\t:.7);
      }
      \draw(0,0)circle(2);
      \draw[fill=white](0:2)node[left]{\tiny Earth}circle(.1);
      \draw[-{>[scale=2.5,length=2,width=3]}](0:2.4)arc(0:45:2.4);
      \node[below]at(0,-2.5){开始位置};
    \end{scope}
    \begin{scope}[shift={(6,0)}]
      % the sun
      \draw(0,0)circle(.3);
      \foreach \t in{0,30,60,90,120,150,180,210,240,270,300,330}{%
        \draw(\t:.5)--(\t:.7);
      }
      \draw(0,0)circle(2);
      \draw[dashed,help lines,fill=white](0:2)circle(.1);
      \draw[fill=white](350:2)circle(.1);
      \draw[dashed,help lines,-{>[scale=2.5,length=2,width=3]}](0:2.4)arc(0:350:2.4);
      \draw[dashed,help lines,<->](350:2.8)arc(350:360:2.4);
      \draw[dashed,help lines](3,0)--(0,0)--(350:3);
      \path (355:2)--(355:3)node[sloped,right]{0.2422天};
      \node[below]at(0,-2.5){一个日历年之后};
    \end{scope}
  \end{tikzpicture}
\end{center}

按儒略历每4年一闰日，日历上过了4年为$1+365\times4$天，而实际的4个太阳年共有$365.2422\times4$天，4年下来其误差为$1+365\times4-365.2422\times4=1-0.2422\times4=0.0312$天，再扩大一下，日历上过了400年，则与实际的400个太阳年误差为3.12天，即比太阳年多跑了3.12天。为解决这个误差，格里历(Gregorian Calendar)，即现在通用的公历，在每400年中去掉3个闰年。格里历的置闰规则如下：
\begin{quotation}
  四年一闰，百年不闰，四百年再闰。
\end{quotation}

剩余的每400年产生的$3.12-3=0.12$天的误差，就需要后人在用到时继续修正了。

\begin{definition}[闰年，Leap Year]
  2月份有28天的称为平年，2月份有29天的称为闰年。确定平年闰年的方法是：
  \begin{enumerate}
  \item 能被400整除的年份定为闰年；
  \item 否则能被100整除的年份定为平年；
  \item 否则能被4整除的年份定为闰年；
  \item 其余年份定为平年。
  \end{enumerate}
  即不能被4整除的都是平年；能被400整除的是闰年；不能被400整除但能被100整除的是平年；不能被100整除但能被4整除的是闰年。
\end{definition}

闰年置闰日的方法是在当年2月份增加一天，从原来的28天加到29天。

\begin{table}[htbp]
  \centering
  \caption{每月天数}
  \label{tab:days-of-months}
  \begin{minipage}{\textwidth}  %for footnote in tabular
  \centering
  \begin{tabular}{ccccccccccccc}
    \toprule
    月份 & 1  & 2          & 3  & 4  & 5  & 6  & 7  & 8  & 9  & 10 & 11 & 12\\\midrule
    天数 & 31 & 28\footnote{平年28天，闰年29天} & 31 & 30 & 31 & 30 & 31 & 31 & 30 & 31 & 30 & 31\\
    \bottomrule
  \end{tabular}
  \end{minipage}
\end{table}

\begin{example}
  公元1900年是平年，因为$400\notdivides 1900$，但$100\mid 1900$。公元2012年是闰年，因为$4\mid 2012$但$100\notdivides 2012$。
\end{example}

\begin{example}
  小明已经上小学4年级了，可是他却说：“我妈妈说我每个生日都没有落下，可是我到现在为止总共才给我过了3个生日。”小明说的有可能吗？
\end{example}
\begin{proof}[提示]
  比如闰年闰日过生日。
\end{proof}

\begin{example}[10年3650天]
  陈奕迅有首歌叫《十年》，吕珊有首歌叫《3650夜》。那么，十年到底有可能是几天？
\end{example}
\begin{proof}[提示]
  普通情况下，四年一闰。考虑到百年不闰的情况，十年有可能有一个闰年、两个闰年或三个闰年。
  {\small
  \begin{align*}
    \underline{2008},\ 2009,\ 2010,\ 2011,\ \underline{2012},\ 2013,\ 2014,\ 2015,\ \underline{2016},\ 2017,\ 2018,\ 2019,\ \underline{2020}
  \end{align*}
  }
  从2008--2017这十年包含了3个闰年(下划线部分)，从2009--2018这十年包含了两个闰年。考虑百年不闰的1900年，以其为中心向两边扩散，则十年的范围有可能只包含一个闰年。
  {
  \begin{align*}
    1897,\ 1898,\ 1899,\ 1900,\ 1901,\ 1902,\ 1903,\ \underline{1904},\ 1905,\ 1906&\qedhere
  \end{align*}
  }
\end{proof}

\begin{example}
  小明是2013年入学的小学生，今年全家去旅行，过了三天后回家。到家后小明一连撕掉了3张日历。姨妈打电话过来问起小明什么时候去的旅行，小明说不记得了，只记得刚刚撕掉的3张日历的数字和是32。那么你知道小明旅行是在哪一年吗？
\end{example}
\begin{proof}[提示]
  撕掉3张日历，暗示了这3张正好对应小明旅行的3天日期。两种情况，一是3天都是同一月份，二是3天在不同的月份。

  如果3天是同一月份，则连续3天的日期之和应能被3整除，然而32并不能被3整除，排除这种情况。

  3天不在同一月份，则必须有一天是上月月末，一天是当月第一天即1号，另外一天可能是当月2号，也可能是上月倒数第二天。如果是上月月末一天外加当月1号2号两天，则上月月末日期数字为$32-1-2=29$。如果是当月1号外加上月最后两天，则上月最后两天的日期数字之和为$32-1=31$，不可能，因为每月最后两天日期数字之和最小的也有$27+28>31$。所以被撕掉的3天日期的唯一情况是$29,1,2$。

  从而当年是闰年。从2013年开始的闰年按顺序依次为：2016，2020，2024，$\cdots\cdots$。而小明是2013年上的小学，题目中说明全家旅行时小明仍然是小学生。如果是2020年的2月份去的旅行，那么小明在旅行时应该已经是初中二年级上学期了，所以题目中说的今年只能是2016年。
\end{proof}

\begin{example}
  柳如是在给岳怜花表演魔术。柳如是请岳怜花在一张纸上写上她的生日的月份，将这个数字乘以4，加13，然后再乘以25。之后减200，然后再加上她生日的日期(即生日年月日里的“日”)，然后乘以2，再减40，再乘以50，然后再加上她出生年份的后两位数。柳如是请岳怜花将最后的结果说出来，岳怜花说是71512。柳如是想了一下，说：“那我知道你是什么时候出生的了，2012年6月10日。”岳怜花说：“太神奇了！可是你早就知道我的生日了呀。”
\end{example}
\begin{proof}[提示]
  这个问题其实与日历关系不大，只是个普通的数字游戏。记岳怜花的出生年(后两位)月日分别是$y$，$m$和$d$，最终结果为$s$，则
  \begin{align*}
    s ={}& \left\{ \left[ (4m + 13)\times 25 - 200 + d \right]\times 2 - 40 \right\} \times 50 + y \\
      ={}&       \left[ (100m + 325 - 200 + d) \times 2 - 40 \right] \times 50 + y\\
      ={}& (200m + 210 + 2d) \times 50 + y\\
      ={}& 10000m + 10500 + 100d + y
  \end{align*}
  所以$(s - 10500$这个数字，万位以上的数字就是$m$(月份)，千位与百倍两数字组成的就是$d$(日)，最后两位就是年。

  回到柳如是的魔术，$71512 - 1050 = 61012$，最后面两位$12$是年，紧接着两位$10$是日，剩余的$6$就是月。

  从后往前反过来推，也可以设计不同的数字魔法。比如若化简到最后的结果为
  \begin{align*}
    s = 10000y + 100m + d + 1234
  \end{align*}
  那么最后的结果减去1234之后，最后两位就是日，紧接着两位就是月，剩余最前面的就是年。
\end{proof}



\section{太阴历}
\label{sec:tai-yin-calendar}

太阴历(即常说的阴历，Lunar Calendar)，是指按月亮的月相周期来安排的历法。太阴历的一年有12个朔望月，约354或355天。根据月亮绕地球运行一周定为一个月，称为朔望月，大约是29.53天，分为大月30日，小月29日。

{\color{red}补充月相!!!。}

{\color{red}补充农历的定义！！}

农历是东亚地区传统广泛使用的阴阳历，据说是由黄帝所创，亦有说是夏朝时他创，所以也称为黄历、夏历。后来以西历格里历为公历，夏历就改称为了农历。西历通常又称为阳历，对应的农历就常被称为阴历。在农耕活动中，阳历更能反映春天播种、秋天收割的农业周期。然而由于古代历法是阴历用的是月相周期，所以古人就用了符合阳历规律的节气来指导农耕。即现在所说的阴历(农历)在天文学中实际上是一种阴阳合历。


\section{大明历}
\label{sec:da-ming-calendar}

南北朝时期的祖冲之在公元465(也有人说是公元462年，即刘宋大明六年，而非明朝)制定了大明历，亦称为甲子元历。祖冲之在此之前就测得了地球围绕太阳旋转一周的天数大约为$365\dfrac{9589}{39491}$，即约365.2428148天；一个朔望月为$29\dfrac{2090}{3939}$，即约29.53天。

大明历首次采用了岁差的概念，这是中国历法上的第二次大变革。

\begin{definition}[岁差，Axial Precession\footnote{字面意思为自转轴进动。}]
  天文学中，一个天体由于其重力作用导致的自转轴指向在空间中缓慢且连续的变化称为岁差。
\end{definition}

%由于该数不是正整数，古人制定历法，很重要的一件事情就是对历法调整安排，使得制定的历法与季节的循环相匹配。

\section{节气}
\label{sec:jie-qi}

古人把$360^\circ$黄经划分24等分，每隔$15^\circ$为一节气，其中$0^\circ$为春分，夏至是$90^\circ$，秋分是$180^\circ$，冬至是$270^\circ$。而太阳黄经在$15^\circ$时则定为清明，太阳直射北回归线之日即中国北方最热之时定为夏至，如图~\ref{fig:24-jie-qi}所示。

公历(即格里历)是根据太阳年来确定，其日期是与黄经基本是一一对应的，误差在一日之内(闰日)，所以黄经每个角度对应的公历日期基本是固定的，所以节气在公历上的体现也基本是固定的，误差也在一日之内。

\begin{figure}[htbp]
  \centering
  \begin{tikzpicture}[scale=1.0]
    \draw(0,0)circle(5);
    \foreach \a/\v in {0/春分,15/清明,30/谷雨,45/立夏,60/小满,75/芒种,90/夏至,
      105/小暑,120/大暑,135/立秋,150/处暑,165/白露,180/秋分,
      195/寒露,210/霜降,225/立冬,240/小雪,255/大雪,270/冬至,
      285/小寒,300/大寒,315/立春,330/雨水,345/惊蛰
    }{
      \draw(0,0)--(90-\a:5.2)node[pos=1.1]{\v};
    }
    \foreach \a/\r/\v in {0/4.5/$0^\circ$, 90/4.3/$90^\circ$, 180/4.5/$180^\circ$, 270/4.2/$270^\circ$}{
      \draw[very thick](0,0)--(90-\a:5.2);
      \node[fill=white] at(90-\a:\r) {\v};
    }
    \foreach \a/\r/\v in {45/4.3/$45^\circ$, 135/4.3/$135^\circ$, 225/4.2/$225^\circ$, 315/4.2/$315^\circ$}{
      % \draw[very thick](0,0)--(90-\a:5.2);
      \node[fill=white] at(90-\a:\r) {\v};
    }
  \end{tikzpicture}
  \caption{二十四节气}
  \label{fig:24-jie-qi}
\end{figure}

节气是古人用于指导工作的，如春耕、播种等，与太阳与地球的相对位置密切相关的。节气实际上是一种阳历。即中国古代所使用的历法既包括阴历，也包括阳历(节气)，所以实际上是一种阴阳历。


\section{天干地支}
\label{sec:gan-zhi}

天干地支是中国古代的记数方法。

\begin{definition}[天干]
  十天干是指：\nopagebreak

  \centering
  甲、乙、丙、丁、戊、己、庚、辛、壬、癸
\end{definition}

\begin{definition}[地支]
  十二地支是指：\nopagebreak

  \centering
  子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥
\end{definition}

天干和地支组合就是以「甲子」为首的六十干支循环，如表~\ref{tab:gan-zhi-loop}。这是一种循环配对，并不是天干任取一个，地支任取一个总数为$10\times12=120$种的配对。容易观察到，由于天干与地支的个数都是偶数，这种循环配对只有奇数配奇数，偶数配偶数的配法，如排第1的天干“甲”，便只能与排1、3、5、7、9、11的“子、寅、辰、午、申、戌”配对。

\begin{table}[htbp]
  \centering
  \caption{干支循环}
  \label{tab:gan-zhi-loop}
  \begin{tikzpicture}[scale=1.0]
    \setcounter{X}{0}
    \newcommand{\dizhi}{品}
    \foreach \y in{0,1,2,3,4,5}{%,6,7,8,9,10,11}{%
      \foreach \x/\tiangan in{0/甲,1/乙,2/丙,3/丁,4/戊,5/己,6/庚,7/辛,8/壬,9/癸}{%
        % \foreach \y in{0/子,1/丑,2/寅,3/卯,4/辰,5/巳,6/午,7/未,8/申,9/酉,10/戌,11/亥}{%
        % FIXME: \underline cause box raised!!
        \ifnum0=\theX      {\node at(\x,-\y*.8){\raisebox{-6pt}{\underline{\tiangan{}子}}};}
        \else\ifnum\theX=1 {\node at(\x,-\y*.8){\tiangan{}丑};}
        \else\ifnum\theX=2 {\node at(\x,-\y*.8){\tiangan{}寅};}
        \else\ifnum\theX=3 {\node at(\x,-\y*.8){\tiangan{}卯};}
        \else\ifnum\theX=4 {\node at(\x,-\y*.8){\tiangan{}辰};}
        \else\ifnum\theX=5 {\node at(\x,-\y*.8){\tiangan{}巳};}
        \else\ifnum\theX=6 {\node at(\x,-\y*.8){\tiangan{}午};}
        \else\ifnum\theX=7 {\node at(\x,-\y*.8){\tiangan{}未};}
        \else\ifnum\theX=8 {\node at(\x,-\y*.8){\tiangan{}申};}
        \else\ifnum\theX=9 {\node at(\x,-\y*.8){\tiangan{}酉};}
        \else\ifnum\theX=10{\node at(\x,-\y*.8){\tiangan{}戌};}
        \else\ifnum\theX=11{\node at(\x,-\y*.8){\tiangan{}亥};}
        \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi
        \stepcounter{X}
        \ifnum\theX=12\setcounter{X}{0}\fi
      }
    }
  \end{tikzpicture}
\end{table}